<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Results | {{ subject }} | NEET Prep Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
</head>
<body>
    <div class="result-bg"></div>
    
    <header>
        <div class="navbar">
            <a href="/" class="logo">
            
                <span>NEET<span class="highlight">Prep</span>Pro</span>
            </a>
            <div class="nav-links">
                <a href="/"><i class="fas fa-home"></i> Home</a>
                <a href="/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
            </div>
        </div>
    </header>
    
    <main class="container">
        <div class="result-header">
            <div class="result-title">
                <h1>Quiz <span class="highlight">Results</span></h1>
                <p>{{ subject }} ({{ year }}) â€¢ {{ questions|length }} Questions</p>
            </div>
            
            <div class="result-score">
                <div class="score-circle">
                    <svg class="circle-chart" viewBox="0 0 36 36">
                        <path class="circle-bg"
                            d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <path class="circle-fill"
                            stroke-dasharray="{{ percentage }},100"
                            d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                        />
                        <text x="18" y="20.5" class="percentage">{{ "%.1f"|format(percentage) }}%</text>
                    </svg>
                </div>
                
                <div class="score-details">
                    <div class="score-detail correct">
                        <div class="detail-value">{{ score }}</div>
                        <div class="detail-label">Correct</div>
                    </div>
                    
                    <div class="score-detail incorrect">
                        <div class="detail-value">{{ total - score }}</div>
                        <div class="detail-label">Incorrect</div>
                    </div>
                    
                    <div class="score-detail total">
                        <div class="detail-value">{{ total }}</div>
                        <div class="detail-label">Total</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="result-message">
            {% if percentage >= 80 %}
            <div class="message-card success">
                <i class="fas fa-trophy"></i>
                <h3>Excellent Performance!</h3>
                <p>You're in the top 10% of NEET aspirants for this subject. Keep up the great work!</p>
            </div>
            {% elif percentage >= 60 %}
            <div class="message-card good">
                <i class="fas fa-thumbs-up"></i>
                <h3>Good Job!</h3>
                <p>You're performing better than average. Focus on your weak areas to improve further.</p>
            </div>
            {% elif percentage >= 40 %}
            <div class="message-card average">
                <i class="fas fa-book-open"></i>
                <h3>Keep Practicing!</h3>
                <p>You're making progress. Review the concepts below and try again.</p>
            </div>
            {% else %}
            <div class="message-card poor">
                <i class="fas fa-lightbulb"></i>
                <h3>Need Improvement</h3>
                <p>Don't worry! Analyze your mistakes below and focus on understanding concepts.</p>
            </div>
            {% endif %}
        </div>
        
        <div class="result-analysis">
            <h2 class="section-title">Detailed <span class="highlight">Analysis</span></h2>
            
            <div class="analysis-tabs">
                <button class="tab-btn active" data-tab="questions">Question Review</button>
                <button class="tab-btn" data-tab="subject">Subject Analysis</button>
                <button class="tab-btn" data-tab="time">Time Analysis</button>
            </div>
            
            <div class="tab-content active" id="questions-tab">
                {% for answer in user_answers %}
                <div class="question-result {% if answer['is_correct'] %}correct{% else %}incorrect{% endif %}">
                    <div class="question-header">
                        <div class="question-status">
                            {% if answer['is_correct'] %}
                            <i class="fas fa-check-circle"></i> Correct
                            {% else %}
                            <i class="fas fa-times-circle"></i> Incorrect
                            {% endif %}
                        </div>
                        <div class="question-marks">4 Marks</div>
                    </div>
                    
                    <div class="question-text">{{ answer['question'] }}</div>
                    
                    <div class="answer-section">
                        <div class="user-answer">
                            <span class="answer-label">Your Answer:</span>
                            <span class="answer-value {% if not answer['is_correct'] %}wrong{% endif %}">
                                {{ answer['user_answer'] if answer['user_answer'] else 'Not Attempted' }}
                            </span>
                        </div>
                        
                        {% if not answer['is_correct'] %}
                        <div class="correct-answer">
                            <span class="answer-label">Correct Answer:</span>
                            <span class="answer-value">{{ answer['correct_answer'] }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="explanation">
                        <div class="explanation-header">
                            <i class="fas fa-lightbulb"></i>
                            <h4>Concept Explanation</h4>
                        </div>
                        <div class="explanation-content">
                            {{ answer['explanation'] }}
                        </div>
                    </div>
                    
                    <div class="question-actions">
                        <button class="action-btn save-btn">
                            <i class="fas fa-bookmark"></i> Save for Later
                        </button>
                        <button class="action-btn report-btn">
                            <i class="fas fa-flag"></i> Report Issue
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="result-actions">
            <a href="/quiz" class="btn btn-outline">
                <i class="fas fa-redo"></i> Retry This Quiz
            </a>
            <a href="/" class="btn btn-primary">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </div>
    </main>
    
    <script>
        // Tab functionality
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all buttons and contents
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                btn.classList.add('active');
                const tabId = btn.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Animate score circle on load
        document.addEventListener('DOMContentLoaded', () => {
            const circleFill = document.querySelector('.circle-fill');
            circleFill.style.animation = 'circle-fill-animation 1.5s ease-out forwards';
        });
    </script>
</body>
</html>